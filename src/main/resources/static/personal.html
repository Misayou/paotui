<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>个人订单</title>
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/resume.css" rel="stylesheet">
    <link rel="stylesheet" href="libs/layui/css/layui.css">
    <!--<link rel="stylesheet" href="css/login.css">-->
    <!--<link rel="stylesheet" href="css/makeorder.css">-->

</head>

<body id="page-top">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
    <a class="navbar-brand js-scroll-trigger" href="/index.html">
        <span class="d-none d-lg-block">
          <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="images/profile.jpg" alt="">
        </span>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link js-scroll-trigger" href="#searchOrder-now">当前订单</a>
            </li>
            <li class="nav-item">
                <a class="nav-link js-scroll-trigger" href="#mymsg">消息中心</a>
            </li>
            <li class="nav-item">
                <a class="nav-link js-scroll-trigger" href="#myreputation">个人信誉</a>
            </li>
            <li class="nav-item">
                <a class="nav-link js-scroll-trigger" href="#mine">认证成为跑腿员</a>
            </li>

        </ul>
    </div>
</nav>

<div class="container-fluid px-6">

    <section class="resume-section p-3 p-lg-5 d-flex d-column" id="searchOrder-now">
        <div class="my-auto">
            <h1 class="mb-0">订单
                <span class="text-primary">Order</span>
            </h1>
            <div class="subheading mb-5"> ·查看自己当前的订单的状态 ·
                <div class="searchOrder-now" onclick="gotoChangeOrderStatus()">
                    <a href="#">当前的订单状态为：<span id="status"></span></a>
                </div>
            </div>
            <div class="subheading mb-5"> ·查看自己的历史订单 ·</div>
            <table id="demo" lay-filter="test"></table>
        </div>
    </section>

    <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="mymsg">
        <div class="my-auto">
            <h2 class="mb-5">我的消息（正在开发）</h2>

            <!--消息开始-->
            <div class="resume-item d-flex flex-column flex-md-row mb-5">
                <div class="resume-content mr-auto">
                    <h3 class="mb-0">收到了一条新消息</h3>
                    <div class="subheading mb-3">来自  <span id="mymsg_name">张三</span></div>
                    <p id="text">合作愉快。感谢你的帮助，下次有需要希望还能帮忙。</p>
                </div>
                <div class="resume-date text-md-right">
                    <span class="text-primary" id="mymsg_time">Nov 2019 - 8:00</span>
                    <button class="layui-btn layui-btn-sm">回复消息</button>
                </div>

            </div>

            <!--消息结束-->



        </div>

    </section>

    <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="myreputation">
        <div class="my-auto">
            <h1 class="mb-0">信誉
                <span class="text-primary">reputation</span>
            </h1>
            <div class="resume-item d-flex flex-column flex-md-row mb-5">
                <div class="myreputation">
                    <h3> 当前的信誉为：<span id="sumReputation"></span></h3>
                </div>
            </div>

            <div class="resume-item d-flex flex-column flex-md-row">
                <div class="resume-content mr-auto">
                    <h3 class="mb-0">信誉得分明细如下：</h3>
                    <table id="demo1" lay-filter="test"></table>
                </div>

            </div>
        </div>
    </section>

    <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="mine">
        <div class="my-auto">
            <h2 class="mb-5">跑腿员认证</h2>
            <div class="subheading mb-5"> ·用学生身份认证成为跑腿员 ·</div>
            <div class="login-box">
                <form class="layui-form layui-form-pane" method="get" action="/auth/auth">
                    <div class="layui-form-item">
                        <label class="layui-form-label">学校：</label>

                        <div class="layui-input-inline">
                            <input type="text" name="account" class="layui-input" lay-verify="school" placeholder="学校" autocomplete="on" maxlength="20"/>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">姓名：</label>

                        <div class="layui-input-inline">
                            <input type="text" id="real_name" class="layui-input"  placeholder="姓名" maxlength="20"/>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">学号：</label>

                        <div class="layui-input-inline">
                            <input type="text" id="student_id" class="layui-input"  placeholder="学号" maxlength="20"/>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <button type="reset" class="layui-btn layui-btn-danger btn-reset">重置</button>
                        <button type="button" class="layui-btn btn-submit" lay-submit="" lay-filter="sub" onclick="submitAuthInfo()">立即认证</button>
                    </div>
                </form>
            </div>
        </div>
    </section>


</div>

<!-- Bootstrap core JavaScript -->
<script src="libs/jquery-2.1.4/jquery.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>

<!-- Plugin JavaScript -->
<script src="js/jquery.easing.min.js"></script>

<!-- Custom scripts for this template -->
<script src="js/resume.js"></script>
<script src="libs/layui/layui.js"></script>
<script src="js/common.js"></script>
<script>

    var layer;
    // 订单部分的js
    layui.use(['table','layer'], function(){
        var table = layui.table;
        layer=layui.layer;
        table.render({
            elem: '#demo'
            ,height: 350
            ,url: 'order/getUserOrders' //数据接口
            ,page: true //开启分页
            ,cols: [[ //表头
                {field: 'id', title: 'ID', width:80, sort: true, fixed: 'left'}
                ,{field: 'title', title: '订单内容', width:177}
                ,{field: 'begin', title: '起点', width:80, sort: true}
                ,{field: 'end', title: '目的地', width:80}
                // 订单类型为发布订单方和接受订单方两个
                ,{field: 'status', title: '订单状态', width: 120}
                ,{field: 'reward', title: '酬金', width: 80, sort: true}
            ]]
        });
    });

    // 信誉部分的js
    layui.use('table', function(){
        var table = layui.table;
        table.render({
            elem: '#demo1'
            ,height: 312
            ,url: '/personal/getUserStart' //数据接口
            ,page: true //开启分页
            ,cols: [[ //表头
                {field: 'id', title: 'ID', width:80, sort: true, fixed: 'left'}
                ,{field: 'title', title: '订单内容', width:120}
                ,{field: 'time', title: '时间', width:80, sort: true}
                ,{field: 'reward', title: '酬金', width: 80, sort: true}
                ,{field: 'start', title: '评分', width: 80, sort: true}
            ]]
        });
    });

    // 认证成为跑腿员部分js


    function submitAuthInfo() {
        var real_name=$('#real_name').val();
        var student_id=$('#student_id').val();
        if(real_name===''||student_id===''){
            layer.open({
                title: '提示'
                ,content: '请填写完整的信息'
            });
        }
        $.ajax({
            type:'post',
            url:'/auth/auth',
            data:{
                real_name:real_name,
                student_id:student_id
            },
            success:function (d) {
                layer.open({
                    title: '提示'
                    ,content: d.message
                });
                
            },
            error: function () {
                layer.open({
                    title: '提示'
                    ,content: '网络错误'
                });
            }
        })
    }

    // 会话窗口js


    //若未登录，点击个人中心重新跳转回登录页面
    $(document).ready(function () {

        /*获取用户信息*/
        $.ajax({
            type: 'get',
            url: '/user/getUserInfo',
            success: function (d) {
                if (d.code === 0) {
                    userInfo=d.data;
                } else {
                    window.location.href = "login.html";
                }
            }
        });


        $.ajax({
            type:'get',
            url:'/personal/getSumStart',
            datatype:'json',
            /*            data:{
                            username:username
                        },*/
            success:function (data) {
                $("#sumReputation").text(data[0].start);

            }
        });


        /*获取用户的当前订单状态*/
        $.ajax({
            type:'get',
            url:'/order/getStatus',
            success:function (d) {
                if (d.data.length > 0) {
                    console.log(d.data[0].info);
                    $('#status').text(d.data[0].info);
                    orderId = d.data[0].id;
                    orderStatus = d.data[0].info;
                } else {
                    console.log('没有订单');
                    orderId = -1; //没有正在进行订单，则设置为-1
                }
            }

        });

    });






    function gotoChangeOrderStatus() {
        if(orderId!=-1){
            goto('/status.html?orderId='+orderId+"&status="+orderStatus);
        }

    }
</script>

</body>

</html>
